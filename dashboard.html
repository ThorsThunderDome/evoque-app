<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evoque - My Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="app-content">
        <aside id="sidebar">
            <div class="sidebar-header">
                <img src="https://i.imgur.com/h5364gL.png" alt="Evoque Logo" class="logo">
                <h2>Evoque</h2>
            </div>
            <nav class="nav-menu">
                <ul>
                    <li><a href="dashboard.html" class="active">Dashboard</a></li>
                    <li><a href="explore.html">Explore</a></li>
                    <li><a href="chat.html">Chat</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="creator_hub.html" class="btn btn-secondary">Switch to Creator Space</a>
                <div id="user-profile">
                    <p>Connected as: <strong id="username-display"></strong></p>
                </div>
            </div>
        </aside>

        <main id="main-content">
            <h1>My Supporter Dashboard</h1>

            <section id="my-memberships-section">
                <h2>My Memberships</h2>
                <div id="memberships-grid" class="grid-container">
                    </div>
            </section>

            <section id="my-collection-section">
                <h2>My Collection (NFTs)</h2>
                <div id="collection-grid" class="grid-container">
                    </div>
            </section>
            
            <section id="my-royalties-section">
                <h2>My Royalties</h2>
                <div id="royalties-list">
                     </div>
            </section>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        console.log("Dashboard page loaded. Checking for user data in sessionStorage...");
        // --- 1. CHECK USER AUTHENTICATION ---
        const userDisplay = document.getElementById('username-display');
        const piUserString = sessionStorage.getItem('piUser');
        
        console.log("Data found in sessionStorage:", piUserString);

        if (!piUserString) {
            // If no user data is found, they are not logged in. Redirect to login page.
            console.log("No user data found. Redirecting back to index.html.");
            window.location.href = 'index.html';
            return; // Stop executing the rest of the script
        }

        console.log("User data found. Welcome!");
        const piUser = JSON.parse(piUserString);
        userDisplay.textContent = piUser.username;

        // --- 2. MOCK DATA (for now, we will replace this with Firebase calls) ---
        const mockUserData = {
            memberships: [
                { creatorName: 'Aria Synth', tier: 'Gold Tier', tierIcon: 'üèÜ' },
                { creatorName: 'Leo Quill', tier: 'Silver Tier', tierIcon: 'ü•à' }
            ],
            collection: [
                { type: 'Membership NFT', creatorName: 'Aria Synth', tier: 'Gold Tier', img: 'https://i.imgur.com/example.png' },
                { type: 'First Supporter Badge', creatorName: 'Ben Carter', img: 'https://i.imgur.com/example2.png' }
            ],
            royalties: [
                { creatorName: 'Ben Carter', earnings: 12.5, daysLeft: 280 },
                { creatorName: 'Pixel Pioneers', earnings: 4.2, daysLeft: 150 }
            ]
        };
        
        // --- 3. RENDER FUNCTIONS TO DISPLAY DATA ---
        const membershipsGrid = document.getElementById('memberships-grid');
        const collectionGrid = document.getElementById('collection-grid');
        const royaltiesList = document.getElementById('royalties-list');

        function renderMemberships() {
            membershipsGrid.innerHTML = ''; // Clear existing content
            if(mockUserData.memberships.length === 0) {
                membershipsGrid.innerHTML = '<p>You have no active memberships.</p>';
                return;
            }
            mockUserData.memberships.forEach(m => {
                const card = document.createElement('div');
                card.className = 'membership-card';
                card.innerHTML = `
                    <div class="card-icon">${m.tierIcon}</div>
                    <h3>${m.creatorName}</h3>
                    <p>${m.tier}</p>
                `;
                membershipsGrid.appendChild(card);
            });
        }
        
        function renderCollection() {
            collectionGrid.innerHTML = '';
            if(mockUserData.collection.length === 0) {
                collectionGrid.innerHTML = '<p>Your collection is empty.</p>';
                return;
            }
            mockUserData.collection.forEach(nft => {
                 const card = document.createElement('div');
                card.className = 'nft-card';
                card.innerHTML = `
                    <img src="${nft.img}" alt="NFT Image">
                    <h4>${nft.type}</h4>
                    <p>Creator: ${nft.creatorName}</p>
                    ${nft.tier ? `<p>Tier: ${nft.tier}</p>` : ''}
                `;
                collectionGrid.appendChild(card);
            });
        }

        function renderRoyalties() {
            royaltiesList.innerHTML = '';
             if(mockUserData.royalties.length === 0) {
                royaltiesList.innerHTML = '<p>You are not earning any royalties yet.</p>';
                return;
            }
            mockUserData.royalties.forEach(r => {
                const item = document.createElement('div');
                item.className = 'royalty-item';
                item.innerHTML = `
                    <p><strong>${r.creatorName}:</strong> You've earned ${r.earnings.toFixed(2)} œÄ</p>
                    <span>${r.daysLeft} days left</span>
                `;
                royaltiesList.appendChild(item);
            });
        }

        // --- 4. INITIALIZE PAGE ---
        renderMemberships();
        renderCollection();
        renderRoyalties();
    });
</script>
</body>

</html>
